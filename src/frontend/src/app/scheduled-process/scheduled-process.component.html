<div class="container is-fluid">
  <div class="tile">
    <div class="tile is-parent">
      <div class="tile is-child card">
        <header class="card-header">
          <p class="card-header-title">
            Schedules
          </p>
        </header>
        <div class="card-content">
          <table class="table is-striped scroll">
            <thead id="head">
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Day</th>
                <th>Time</th>
                <th>Interval</th>
                <th>Exclusive</th>
                <th></th>
              </tr>
            </thead>
            <tr *ngFor="let schedule of scheduleData">
              <td><small>{{schedule.name}}</small></td>
              <td><small> {{schedule.type}}</small></td>
              <td><small> {{schedule.day}}</small></td>
              <td><small> {{schedule.time | slice:0:8}}</small></td>
              <td><small> {{schedule.repeat}}</small></td>
              <td><small> {{schedule.exclusive}}</small></td>
               <td>
                <div (click)="editSchedule(schedule.id)"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></div>
              </td>
              <td>
                <div (click)="openModal(schedule.id)"><i class="fa fa-minus-circle" aria-hidden="true"></i></div>
              </td>
            </tr>
          </table>
          <app-modal (notify)='onNotify($event)' [childData]='childData'></app-modal>
          <app-update-modal (notify)='onNotify($event)' [childData]='updateScheduleData'></app-update-modal>
        </div>
      </div>
    </div>
    <div class="tile">
      <div class="tile is-parent">
        <div class="tile is-child card">
          <header class="card-header">
            <p class="card-header-title">
              Create Schedule
            </p>
          </header>
          <div class="card-content">
            <form name="form" (ngSubmit)="f.form.valid && createSchedule()" #f="ngForm" novalidate>
              <div class="columns">
                <div class="column">
                  <div class="field" [ngClass]="{ 'has-error': f.submitted && !scheduler.valid }">
                    <label class="label">Name</label>
                    <p class="control">
                      <input id="name" type="text" class="input" name="scheduler_name" [(ngModel)]="scheduler_name" #scheduler="ngModel" placeholder="name"
                        required />
                    </p>
                    <div *ngIf="f.submitted && !scheduler.valid" class="help is-danger level-left">Name is required</div>
                  </div>
                </div>
                <div class="column">
                  <div class="field">
                    <label class="label">Exclusive</label>
                    <div class="control">
                      <input id="exclusive" type="checkbox" checked>
                    </div>
                  </div>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div class="field">
                    <label class="label">Process Name</label>
                    <div class="control">
                      <div class="select">
                        <select id="process">
                        <option [value]='process' *ngFor="let process of scheduleProcess">{{process}}</option>
                      </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div class="field">
                    <label class="label">Type</label>
                    <div class="control">
                      <div class="select">
                        <select id="type" #t (change)="setScheduleTypeKey(t.value)">
                        <option [value]='type.index' *ngFor="let type of scheduleType">{{type.name}}</option>
                      </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div class="field" [ngClass]="{ 'has-error': f.submitted && invalidRepeat }">
                    <label class="label">Repeat (Interval)</label>
                    <p class="control">
                      <input id="repeat" class="input" type='text' name="repeat" [(ngModel)]="invalidRepeat" #range="ngModel" placeholder="hh:mm:ss"
                        mask='00:00:00' (ngModelChange)="invalidRepeat=false">
                    </p>
                    <div *ngIf="f.submitted && invalidRepeat" class="help is-danger level-left">Repeat must be in 00:00:01, 23:59:59 range</div>
                  </div>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div *ngIf="selected_schedule_type == 2" class="field">
                    <label class="label">Day</label>
                    <div class="control">
                      <div class="select">
                        <select id="day">
                        <option value='1'>Monday</option>
                        <option value='2'>Tuesday</option>
                        <option value='3'>Wednesday</option>
                        <option value='4'>Thursday</option>
                        <option value='5'>Friday</option>
                        <option value='6'>Saturday</option>
                        <option value='7'>Sunday</option>
                      </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="column">
                  <div *ngIf="selected_schedule_type == 2" class="field" [ngClass]="{ 'has-error': f.submitted && invalidTime }">
                    <label class="label">Time</label>
                    <p class="control">
                      <input id="time" class="input" type='text' name="time" [(ngModel)]="invalidTime" #time="ngModel" placeholder="hh:mm:ss" mask='00:00:00'
                        (ngModelChange)="invalidTime=false">
                    </p>
                    <div *ngIf="f.submitted && invalidTime" class="help is-danger level-left">Time must be in 00:00:01, 23:59:59 range</div>
                  </div>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div class="field">
                    <div class="control">
                      <button id="save" class="button is-success">Save</button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tile">
    <div class="tile is-parent">
      <div class="tile is-child card">
        <header class="card-header">
          <p class="card-header-title">
            Latest Tasks
          </p>
        </header>
        <div class="card-content">
          <table class="table is-striped is-narrow">
            <thead>
              <tr>
                <th>PID</th>
                <th>Process</th>
                <th>State</th>
                <th>Start time</th>
                <th>End Time</th>
                <th>Exit Code</th>
                <th>Reason</th>
              </tr>
            </thead>
            <tr *ngFor="let task of tasksData">
              <td><small>{{task.pid}}</small></td>
              <td><small>{{task.process_name}}</small></td>
              <td><small>{{task.state}}</small></td>
              <td><small>{{task.start_time != 'None' ?(task.start_time | date: 'dd-MM-yyyy HH:mm:ss') : task.start_time}}</small></td>
              <td><small>{{task.end_time != 'None'?(task.end_time | date: 'dd-MM-yyyy HH:mm:ss') : task.end_time}}</small></td>
              <td><small>{{task.exit_code}}</small></td>
              <td><small>{{task.reason}}</small></td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>